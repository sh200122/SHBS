{"version":3,"file":"pages/login/index.js","mappings":";;;;;;;;;;;;;;;;;;;AAAA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;;;;;;;;;;;;;ACrHA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA","sources":["webpack://myApp/./src/pages/login/index.tsx?84ae","webpack://myApp/._src_pages_login_index.tsx"],"sourcesContent":["import { View, Text, Form, Input, Button, Label } from \"@tarojs/components\";\nimport Taro from \"@tarojs/taro\";\nimport { useState } from \"react\";\nimport { jsx as _jsx, jsxs as _jsxs } from \"react/jsx-runtime\";\nexport default function Login() {\n  const [formData, setFormData] = useState({\n    email: \"\",\n    password: \"\"\n  });\n  const handleSubmit = async e => {\n    e.preventDefault();\n    try {\n      console.log(\"提交登录请求:\", formData);\n      const response = await Taro.request({\n        url: \"http://localhost:5000/api/admin/login\",\n        method: \"POST\",\n        data: formData,\n        header: {\n          \"content-type\": \"application/json\"\n        }\n      });\n      console.log(\"登录响应:\", response);\n      if (response.statusCode === 200 && response.data.success) {\n        const token = response.data.token;\n\n        // ✅ 先存 Token\n        await Taro.setStorage({\n          key: \"token\",\n          data: token\n        });\n\n        // ✅ 确保 Token 已存储\n        Taro.getStorage({\n          key: \"token\",\n          success: res => {\n            console.log(\"存储的 Token:\", res.data);\n          },\n          fail: () => {\n            console.warn(\"存储失败\");\n          }\n        });\n        Taro.setStorageSync('adminInfo', {\n          _id: response.data.admin._id,\n          name: response.data.admin.name,\n          email: response.data.admin.email\n        });\n        console.log(\"登录成功，准备跳转...\");\n\n        // ✅ 改为 reLaunch，防止 Token 丢失\n        await Taro.reLaunch({\n          url: \"/pages/dashboard/index\"\n        });\n        console.log(\"跳转成功\");\n      } else {\n        console.error(\"登录失败:\", response.data.message);\n        Taro.showToast({\n          title: response.data.message || \"登录失败\",\n          icon: \"error\"\n        });\n      }\n    } catch (error) {\n      console.error(\"登录错误:\", error);\n      Taro.showToast({\n        title: \"登录请求失败\",\n        icon: \"error\"\n      });\n    }\n  };\n  return /*#__PURE__*/_jsxs(View, {\n    className: \"flex flex-col items-center justify-center min-h-screen p-4 bg-[#e8e8e8]\",\n    children: [/*#__PURE__*/_jsx(Text, {\n      className: \"text-2xl font-bold mb-10\",\n      children: \"\\u767B\\u5F55\\u7BA1\\u7406\\u5458\\u7CFB\\u7EDF\"\n    }), /*#__PURE__*/_jsxs(Form, {\n      className: \"flex flex-col gap-4\",\n      onSubmit: handleSubmit,\n      children: [/*#__PURE__*/_jsxs(View, {\n        className: \"flex flex-col gap-2\",\n        children: [/*#__PURE__*/_jsx(Label, {\n          className: \"text-sm font-medium text-gray-700\",\n          children: \"\\u90AE\\u7BB1\"\n        }), /*#__PURE__*/_jsx(Input, {\n          type: \"text\",\n          name: \"email\",\n          placeholder: \"\\u8BF7\\u8F93\\u5165\\u90AE\\u7BB1\",\n          className: \"p-3\",\n          value: formData.email,\n          onInput: e => setFormData({\n            ...formData,\n            email: e.detail.value\n          })\n        })]\n      }), /*#__PURE__*/_jsxs(View, {\n        className: \"flex flex-col gap-2\",\n        children: [/*#__PURE__*/_jsx(Label, {\n          className: \"text-sm font-medium text-gray-700\",\n          children: \"\\u5BC6\\u7801\"\n        }), /*#__PURE__*/_jsx(Input, {\n          type: \"password\" // ✅ 确保密码不明文显示\n          ,\n          name: \"password\",\n          placeholder: \"\\u8BF7\\u8F93\\u5165\\u5BC6\\u7801\",\n          className: \"p-3\",\n          value: formData.password,\n          onInput: e => setFormData({\n            ...formData,\n            password: e.detail.value\n          })\n        })]\n      }), /*#__PURE__*/_jsx(Button, {\n        formType: \"submit\",\n        className: \"bg-green-500 text-white rounded-md mt-10\",\n        hoverClass: \"bg-green-600\",\n        children: \"\\u767B\\u5F55\"\n      })]\n    })]\n  });\n}","import { createPageConfig } from '@tarojs/runtime'\nimport component from \"!!../../../node_modules/@tarojs/taro-loader/lib/entry-cache.js?name=pages/login/index!./index.tsx\"\nvar config = {};\n\n\n\nvar taroOption = createPageConfig(component, 'pages/login/index', {root:{cn:[]}}, config || {})\nif (component && component.behaviors) {\n  taroOption.behaviors = (taroOption.behaviors || []).concat(component.behaviors)\n}\nvar inst = Page(taroOption)\n\n\n\nexport default component\n"],"names":[],"sourceRoot":""}