{"version":3,"file":"pages/person/index.js","mappings":";;;;;;;;;;;;;;;;;;;;;;AAAA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;;;;;;;;;;;;;ACtVA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA","sources":["webpack://myApp/./src/pages/person/index.tsx?6f46","webpack://myApp/._src_pages_person_index.tsx"],"sourcesContent":["import { View, Text, Button, ScrollView } from \"@tarojs/components\";\nimport Header from \"@/components/Header\";\nimport Footer from \"@/components/Footer\";\nimport Taro, { useDidShow } from \"@tarojs/taro\";\nimport { logout } from \"@/utils/auth\";\nimport { useEffect, useState } from \"react\";\nimport { jsx as _jsx, jsxs as _jsxs } from \"react/jsx-runtime\";\nexport default function Setting() {\n  const [selectedOrderType, setSelectedOrderType] = useState(\"å¾…å‘è´§\");\n  const [orders, setOrders] = useState([]);\n  const [loading, setLoading] = useState(true);\n  const orderTypes = [{\n    id: 1,\n    name: \"å¾…å‘è´§\",\n    icon: \"ðŸ“¦\"\n  }, {\n    id: 2,\n    name: \"å¾…æ”¶è´§\",\n    icon: \"ðŸšš\"\n  }, {\n    id: 3,\n    name: \"å·²å®Œæˆ\",\n    icon: \"âœ…\"\n  }, {\n    id: 4,\n    name: \"å…¨éƒ¨è®¢å•\",\n    icon: \"ðŸ“‹\"\n  }];\n\n  // èŽ·å–ç”¨æˆ·è®¢å•\n  const fetchUserOrders = async () => {\n    setLoading(true);\n    try {\n      const token = Taro.getStorageSync(\"token\");\n      if (!token) {\n        Taro.showToast({\n          title: \"è¯·å…ˆç™»å½•\",\n          icon: \"error\",\n          duration: 2000\n        });\n        return;\n      }\n      const response = await Taro.request({\n        url: \"http://localhost:5000/api/orders/user\",\n        method: \"GET\",\n        header: {\n          Authorization: `Bearer ${token}`\n        }\n      });\n      if (response.data.success) {\n        setOrders(response.data.data);\n      } else {\n        throw new Error(response.data.message || \"èŽ·å–è®¢å•å¤±è´¥\");\n      }\n    } catch (error) {\n      console.error(\"èŽ·å–è®¢å•å¤±è´¥:\", error);\n      Taro.showToast({\n        title: \"èŽ·å–è®¢å•å¤±è´¥\",\n        icon: \"error\",\n        duration: 2000\n      });\n    } finally {\n      setLoading(false);\n    }\n  };\n\n  // é¡µé¢åŠ è½½æ—¶èŽ·å–è®¢å•\n  useEffect(() => {\n    fetchUserOrders();\n  }, []);\n\n  // æ¯æ¬¡é¡µé¢æ˜¾ç¤ºæ—¶åˆ·æ–°è®¢å•\n  useDidShow(() => {\n    fetchUserOrders();\n  });\n\n  // å¤„ç†è®¢å•ç±»åž‹åˆ‡æ¢\n  const handleOrderTypeClick = orderName => {\n    setSelectedOrderType(orderName);\n  };\n\n  // å¤„ç†é€€å‡ºç™»å½•\n  const handleLogout = () => {\n    logout();\n    setTimeout(() => {\n      Taro.reLaunch({\n        url: \"/pages/login/index\"\n      });\n    }, 1000);\n  };\n\n  // ç­›é€‰è®¢å•\n  const filteredOrders = orders.filter(order => {\n    if (selectedOrderType === \"å…¨éƒ¨è®¢å•\") {\n      return true;\n    }\n    return order.status === selectedOrderType;\n  });\n\n  // èŽ·å–çŠ¶æ€å¯¹åº”çš„é¢œè‰²\n  const getStatusColor = status => {\n    switch (status) {\n      case \"å¾…å‘è´§\":\n        return \"text-blue-500\";\n      case \"å¾…æ”¶è´§\":\n        return \"text-green-500\";\n      case \"å·²å®Œæˆ\":\n        return \"text-gray-500\";\n      case \"å·²å–æ¶ˆ\":\n        return \"text-red-500\";\n      default:\n        return \"text-gray-700\";\n    }\n  };\n\n  // å¤„ç†ç¡®è®¤æ”¶è´§\n  const handleConfirmReceipt = async orderId => {\n    try {\n      const token = Taro.getStorageSync(\"token\");\n      if (!token) {\n        Taro.showToast({\n          title: \"è¯·å…ˆç™»å½•\",\n          icon: \"error\",\n          duration: 2000\n        });\n        return;\n      }\n      Taro.showModal({\n        title: \"ç¡®è®¤æ”¶è´§\",\n        content: \"ç¡®å®šè¦ç¡®è®¤æ”¶è´§å—ï¼Ÿ\",\n        success: async res => {\n          if (res.confirm) {\n            try {\n              const response = await Taro.request({\n                url: `http://localhost:5000/api/orders/${orderId}/confirm`,\n                method: \"PUT\",\n                header: {\n                  Authorization: `Bearer ${token}`\n                }\n              });\n              if (response.data.success) {\n                Taro.showToast({\n                  title: \"ç¡®è®¤æ”¶è´§æˆåŠŸ\",\n                  icon: \"success\",\n                  duration: 2000\n                });\n                // åˆ·æ–°è®¢å•åˆ—è¡¨\n                fetchUserOrders();\n              } else {\n                throw new Error(response.data.message || \"ç¡®è®¤æ”¶è´§å¤±è´¥\");\n              }\n            } catch (error) {\n              console.error(\"ç¡®è®¤æ”¶è´§å¤±è´¥:\", error);\n              Taro.showToast({\n                title: \"ç¡®è®¤æ”¶è´§å¤±è´¥\",\n                icon: \"error\",\n                duration: 2000\n              });\n            }\n          }\n        }\n      });\n    } catch (error) {\n      console.error(\"ç¡®è®¤æ”¶è´§æ“ä½œå¤±è´¥:\", error);\n      Taro.showToast({\n        title: \"æ“ä½œå¤±è´¥\",\n        icon: \"error\",\n        duration: 2000\n      });\n    }\n  };\n\n  // å¤„ç†å–æ¶ˆè®¢å•\n  const handleCancelOrder = async orderId => {\n    try {\n      const token = Taro.getStorageSync(\"token\");\n      if (!token) {\n        Taro.showToast({\n          title: \"è¯·å…ˆç™»å½•\",\n          icon: \"error\",\n          duration: 2000\n        });\n        return;\n      }\n      Taro.showModal({\n        title: \"å–æ¶ˆè®¢å•\",\n        content: \"ç¡®å®šè¦å–æ¶ˆè¯¥è®¢å•å—ï¼Ÿ\",\n        success: async res => {\n          if (res.confirm) {\n            try {\n              const response = await Taro.request({\n                url: `http://localhost:5000/api/orders/${orderId}/cancel`,\n                method: \"PUT\",\n                header: {\n                  Authorization: `Bearer ${token}`\n                }\n              });\n              if (response.data.success) {\n                Taro.showToast({\n                  title: \"å–æ¶ˆè®¢å•æˆåŠŸ\",\n                  icon: \"success\",\n                  duration: 2000\n                });\n                // åˆ·æ–°è®¢å•åˆ—è¡¨\n                fetchUserOrders();\n              } else {\n                throw new Error(response.data.message || \"å–æ¶ˆè®¢å•å¤±è´¥\");\n              }\n            } catch (error) {\n              console.error(\"å–æ¶ˆè®¢å•å¤±è´¥:\", error);\n              Taro.showToast({\n                title: \"å–æ¶ˆè®¢å•å¤±è´¥\",\n                icon: \"error\",\n                duration: 2000\n              });\n            }\n          }\n        }\n      });\n    } catch (error) {\n      console.error(\"å–æ¶ˆè®¢å•æ“ä½œå¤±è´¥:\", error);\n      Taro.showToast({\n        title: \"æ“ä½œå¤±è´¥\",\n        icon: \"error\",\n        duration: 2000\n      });\n    }\n  };\n  return /*#__PURE__*/_jsxs(View, {\n    className: \"h-screen w-screen\",\n    children: [/*#__PURE__*/_jsx(Header, {}), /*#__PURE__*/_jsx(View, {\n      className: \"fixed top-[11%] h-[84%] bg-gray-100 w-full p-4\",\n      children: /*#__PURE__*/_jsxs(View, {\n        className: \"bg-white rounded-lg shadow p-6 max-w-md mx-auto flex flex-col items-center\",\n        children: [/*#__PURE__*/_jsx(Text, {\n          className: \"text-lg font-bold mb-4\",\n          children: \"\\u5FAE\\u4FE1\\u7528\\u6237:\"\n        }), /*#__PURE__*/_jsxs(Text, {\n          className: \"mb-4\",\n          children: [\"VX\", Taro.getStorageSync(\"userId\")]\n        }), /*#__PURE__*/_jsx(Button, {\n          formType: \"submit\",\n          className: \"bg-red-500 text-white rounded-md w-full\",\n          hoverClass: \"bg-red-600\",\n          onClick: handleLogout,\n          children: \"\\u9000\\u51FA\\u767B\\u5F55\"\n        })]\n      })\n    }), /*#__PURE__*/_jsxs(View, {\n      className: \"bg-white p-4 fixed top-[36%] w-full rounded-lg\",\n      children: [/*#__PURE__*/_jsx(Text, {\n        className: \"text-lg font-bold\",\n        children: \"\\u6211\\u7684\\u8BA2\\u5355\"\n      }), /*#__PURE__*/_jsx(View, {\n        className: \"grid grid-cols-4 gap-4 mt-4\",\n        children: orderTypes.map(order => /*#__PURE__*/_jsxs(View, {\n          className: `flex flex-col items-center justify-center p-2 rounded-lg cursor-pointer ${selectedOrderType === order.name ? \"bg-yellow-100 text-yellow-600\" : \"bg-gray-50\"}`,\n          onClick: () => handleOrderTypeClick(order.name),\n          children: [/*#__PURE__*/_jsx(Text, {\n            className: \"text-2xl mb-1\",\n            children: order.icon\n          }), /*#__PURE__*/_jsx(Text, {\n            className: \"text-sm\",\n            children: order.name\n          })]\n        }, order.id))\n      })]\n    }), /*#__PURE__*/_jsxs(ScrollView, {\n      className: \"fixed bottom-[5%] w-[94%] h-[42%] bg-white rounded-lg px-4\",\n      scrollY: true,\n      enableFlex: true,\n      children: [loading ? /*#__PURE__*/_jsx(View, {\n        className: \"flex items-center justify-center h-32\",\n        children: /*#__PURE__*/_jsx(Text, {\n          className: \"text-gray-500\",\n          children: \"\\u52A0\\u8F7D\\u4E2D...\"\n        })\n      }) : filteredOrders.length === 0 ? /*#__PURE__*/_jsx(View, {\n        className: \"flex items-center justify-center h-32\",\n        children: /*#__PURE__*/_jsxs(Text, {\n          className: \"text-gray-500\",\n          children: [\"\\u6682\\u65E0\", selectedOrderType === \"å…¨éƒ¨è®¢å•\" ? \"\" : selectedOrderType, \"\\u8BA2\\u5355\"]\n        })\n      }) : filteredOrders.map(order => /*#__PURE__*/_jsxs(View, {\n        className: \"bg-white rounded-lg p-4 mb-4 mr-3 shadow-sm border border-gray-100\",\n        children: [/*#__PURE__*/_jsxs(View, {\n          className: \"flex justify-between items-center mb-2\",\n          children: [/*#__PURE__*/_jsxs(Text, {\n            className: \"text-sm text-gray-500\",\n            children: [\"\\u8BA2\\u5355\\u53F7\\uFF1A\", order.orderNo]\n          }), /*#__PURE__*/_jsx(Text, {\n            className: `${getStatusColor(order.status)}`,\n            children: order.status\n          })]\n        }), /*#__PURE__*/_jsx(View, {\n          className: \"border-t border-b border-gray-100 py-3 my-2\",\n          children: /*#__PURE__*/_jsxs(View, {\n            className: \"flex justify-between items-center\",\n            children: [/*#__PURE__*/_jsx(Text, {\n              className: \"text-base font-medium\",\n              children: order.name\n            }), /*#__PURE__*/_jsxs(Text, {\n              className: \"text-sm\",\n              children: [\"x\", order.quantity]\n            })]\n          })\n        }), /*#__PURE__*/_jsxs(View, {\n          className: \"flex justify-between items-center mt-2\",\n          children: [/*#__PURE__*/_jsx(Text, {\n            className: \"text-sm text-gray-500\",\n            children: new Date(order.createTime).toLocaleString()\n          }), /*#__PURE__*/_jsxs(Text, {\n            className: \"text-lg font-medium text-primary\",\n            children: [\"\\xA5\", order.totalAmount.toFixed(2)]\n          })]\n        }), order.status === \"å¾…æ”¶è´§\" && /*#__PURE__*/_jsxs(View, {\n          className: \"flex justify-between mt-3\",\n          children: [/*#__PURE__*/_jsx(Button, {\n            className: \"bg-green-500 text-white rounded flex-1 mr-2\",\n            onClick: () => {\n              handleConfirmReceipt(order._id);\n            },\n            children: \"\\u786E\\u8BA4\\u6536\\u8D27\"\n          }), /*#__PURE__*/_jsx(Button, {\n            className: \"bg-red-500 text-white rounded flex-1\",\n            onClick: () => {\n              handleCancelOrder(order._id);\n            },\n            children: \"\\u53D6\\u6D88\\u8BA2\\u5355\"\n          })]\n        }), order.status === \"å¾…å‘è´§\" && /*#__PURE__*/_jsx(Button, {\n          className: \"bg-red-500 text-white mt-3 rounded\",\n          onClick: () => {\n            handleCancelOrder(order._id);\n          },\n          children: \"\\u53D6\\u6D88\\u8BA2\\u5355\"\n        })]\n      }, order._id)), /*#__PURE__*/_jsx(View, {\n        className: \"h-6\"\n      })]\n    }), /*#__PURE__*/_jsx(Footer, {})]\n  });\n}","import { createPageConfig } from '@tarojs/runtime'\nimport component from \"!!../../../node_modules/@tarojs/taro-loader/lib/entry-cache.js?name=pages/person/index!./index.tsx\"\nvar config = {};\n\n\n\nvar taroOption = createPageConfig(component, 'pages/person/index', {root:{cn:[]}}, config || {})\nif (component && component.behaviors) {\n  taroOption.behaviors = (taroOption.behaviors || []).concat(component.behaviors)\n}\nvar inst = Page(taroOption)\n\n\n\nexport default component\n"],"names":[],"sourceRoot":""}