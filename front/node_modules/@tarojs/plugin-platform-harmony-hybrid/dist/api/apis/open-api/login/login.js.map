{"version":3,"file":"login.js","sources":["../../../../../src/api/apis/open-api/login/login.ts"],"sourcesContent":["import Taro from '@tarojs/taro'\n\nimport native from '../../NativeApi'\nimport { shouldBeObject } from '../../utils'\nimport { MethodHandler } from '../../utils/handler'\n\n/**\n * 调用接口获取登录凭证（code）\n *\n * @canUse login\n * @__object [timeout]\n * @__success [code]\n */\nexport const login: typeof Taro.login = (options) => {\n  const name = 'login'\n\n  // options must be an Object\n  const isObject = shouldBeObject(options)\n  if (!isObject.flag) {\n    const res = { errMsg: `${name}:fail ${isObject.msg}` }\n    console.error(res.errMsg)\n    return Promise.reject(res)\n  }\n\n  const { timeout, success, fail, complete } = options as Exclude<typeof options, undefined>\n  const handle = new MethodHandler({ name, success, fail, complete })\n\n  let loginPromise = new Promise((resolve, reject) => {\n    native.login({\n      success: (res: any) => {\n        resolve(res)\n      },\n      fail: (err: any) => {\n        reject(err)\n      },\n    })\n  })\n  if (typeof timeout === 'number' && timeout >= 0) {\n    const timeoutPromise = new Promise((_resolve, reject) => {\n      setTimeout(() => reject(new Error('timeout')), timeout)\n    })\n    loginPromise = Promise.race([loginPromise, timeoutPromise])\n  }\n  return loginPromise.then(\n    (res: any) => handle.success(res),\n    (err) => {\n      if (err instanceof Error) {\n        return handle.fail({ errMsg: err.message })\n      } else {\n        const { errMsg, errCode: code } = err\n        return handle.fail({ errMsg, code })\n      }\n    }\n  )\n}\n"],"names":[],"mappings":";;;;AAMA;;;;;;AAMG;AACU,MAAA,KAAK,GAAsB,CAAC,OAAO,KAAI;IAClD,MAAM,IAAI,GAAG,OAAO,CAAA;;AAGpB,IAAA,MAAM,QAAQ,GAAG,cAAc,CAAC,OAAO,CAAC,CAAA;AACxC,IAAA,IAAI,CAAC,QAAQ,CAAC,IAAI,EAAE;AAClB,QAAA,MAAM,GAAG,GAAG,EAAE,MAAM,EAAE,CAAA,EAAG,IAAI,CAAA,MAAA,EAAS,QAAQ,CAAC,GAAG,CAAA,CAAE,EAAE,CAAA;AACtD,QAAA,OAAO,CAAC,KAAK,CAAC,GAAG,CAAC,MAAM,CAAC,CAAA;AACzB,QAAA,OAAO,OAAO,CAAC,MAAM,CAAC,GAAG,CAAC,CAAA;KAC3B;IAED,MAAM,EAAE,OAAO,EAAE,OAAO,EAAE,IAAI,EAAE,QAAQ,EAAE,GAAG,OAA6C,CAAA;AAC1F,IAAA,MAAM,MAAM,GAAG,IAAI,aAAa,CAAC,EAAE,IAAI,EAAE,OAAO,EAAE,IAAI,EAAE,QAAQ,EAAE,CAAC,CAAA;IAEnE,IAAI,YAAY,GAAG,IAAI,OAAO,CAAC,CAAC,OAAO,EAAE,MAAM,KAAI;QACjD,MAAM,CAAC,KAAK,CAAC;AACX,YAAA,OAAO,EAAE,CAAC,GAAQ,KAAI;gBACpB,OAAO,CAAC,GAAG,CAAC,CAAA;aACb;AACD,YAAA,IAAI,EAAE,CAAC,GAAQ,KAAI;gBACjB,MAAM,CAAC,GAAG,CAAC,CAAA;aACZ;AACF,SAAA,CAAC,CAAA;AACJ,KAAC,CAAC,CAAA;IACF,IAAI,OAAO,OAAO,KAAK,QAAQ,IAAI,OAAO,IAAI,CAAC,EAAE;QAC/C,MAAM,cAAc,GAAG,IAAI,OAAO,CAAC,CAAC,QAAQ,EAAE,MAAM,KAAI;AACtD,YAAA,UAAU,CAAC,MAAM,MAAM,CAAC,IAAI,KAAK,CAAC,SAAS,CAAC,CAAC,EAAE,OAAO,CAAC,CAAA;AACzD,SAAC,CAAC,CAAA;QACF,YAAY,GAAG,OAAO,CAAC,IAAI,CAAC,CAAC,YAAY,EAAE,cAAc,CAAC,CAAC,CAAA;KAC5D;AACD,IAAA,OAAO,YAAY,CAAC,IAAI,CACtB,CAAC,GAAQ,KAAK,MAAM,CAAC,OAAO,CAAC,GAAG,CAAC,EACjC,CAAC,GAAG,KAAI;AACN,QAAA,IAAI,GAAG,YAAY,KAAK,EAAE;AACxB,YAAA,OAAO,MAAM,CAAC,IAAI,CAAC,EAAE,MAAM,EAAE,GAAG,CAAC,OAAO,EAAE,CAAC,CAAA;SAC5C;aAAM;YACL,MAAM,EAAE,MAAM,EAAE,OAAO,EAAE,IAAI,EAAE,GAAG,GAAG,CAAA;YACrC,OAAO,MAAM,CAAC,IAAI,CAAC,EAAE,MAAM,EAAE,IAAI,EAAE,CAAC,CAAA;SACrC;AACH,KAAC,CACF,CAAA;AACH;;;;"}