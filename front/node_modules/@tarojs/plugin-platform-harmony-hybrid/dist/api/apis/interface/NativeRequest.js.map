{"version":3,"file":"NativeRequest.js","sources":["../../../../src/api/apis/interface/NativeRequest.ts"],"sourcesContent":["import Taro from '@tarojs/api'\nimport { fromByteArray } from 'base64-js'\n\nimport { ClassInstanceManager } from './ClassInstanceManager'\n\nexport class NativeRequest implements Taro.RequestTask<any> {\n  readonly className: string = 'NativeRequest'\n  readonly [Symbol.toStringTag]: string = ''\n  private objectId: number\n  constructor (option: any) {\n    if (option?.data instanceof ArrayBuffer) {\n      option.bufBase64 = fromByteArray(new Uint8Array(option.data))\n      option.data = undefined\n    }\n    const options = {\n      ...option,\n      success: (res: any) => {\n        option?.success(res)\n        this.destroy()\n      },\n      fail: (res: any) => {\n        option?.fail(res)\n        this.destroy()\n      }\n    }\n    this.objectId = ClassInstanceManager.getInstance().createInstance(this.className, options)\n  }\n\n  static createRequestTask (option: any) {\n    return new NativeRequest(option)\n  }\n\n  abort (): void {\n    ClassInstanceManager.getInstance().setInstanceFunction({}, this.className, 'abort', this.objectId)\n    this.destroy()\n  }\n\n  onHeadersReceived (option: any): void {\n    ClassInstanceManager.getInstance().setInstanceFunctionAsync(option, this.className, 'onHeadersReceived', this.objectId)\n  }\n\n  offHeadersReceived (option: any): void {\n    ClassInstanceManager.getInstance().setInstanceFunction(option, this.className, 'offHeadersReceived', this.objectId)\n  }\n\n  catch<TResult = never> (\n    onrejected?: ((reason: any) => PromiseLike<TResult> | TResult) | undefined | null\n  ): Promise<any> {\n    return Promise.resolve(onrejected)\n  }\n\n  offChunkReceived (option: any): void {\n    return option\n  }\n\n  onChunkReceived (option: any): void {\n    return option\n  }\n\n  destroy (): void {\n    ClassInstanceManager.getInstance().destroyInstance(this.className, this.objectId)\n  }\n\n  then<TResult = never> (\n    onrejected?: ((reason: any) => PromiseLike<TResult> | TResult) | undefined | null\n  ): Promise<any> {\n    return Promise.resolve(onrejected)\n  }\n\n  finally (onfinally?: (() => void) | null | undefined): any {\n    throw new Error(onfinally as undefined)\n  }\n}\n"],"names":[],"mappings":";;;;MAKa,aAAa,CAAA;AAIxB,IAAA,WAAA,CAAa,MAAW,EAAA;QAHf,IAAS,CAAA,SAAA,GAAW,eAAe,CAAA;QACnC,IAAoB,CAAA,EAAA,CAAA,GAAW,EAAE,CAAA;QAGxC,IAAI,CAAA,MAAM,KAAA,IAAA,IAAN,MAAM,KAAA,KAAA,CAAA,GAAA,KAAA,CAAA,GAAN,MAAM,CAAE,IAAI,aAAY,WAAW,EAAE;AACvC,YAAA,MAAM,CAAC,SAAS,GAAG,aAAa,CAAC,IAAI,UAAU,CAAC,MAAM,CAAC,IAAI,CAAC,CAAC,CAAA;AAC7D,YAAA,MAAM,CAAC,IAAI,GAAG,SAAS,CAAA;SACxB;QACD,MAAM,OAAO,mCACR,MAAM,CAAA,EAAA,EACT,OAAO,EAAE,CAAC,GAAQ,KAAI;gBACpB,MAAM,KAAA,IAAA,IAAN,MAAM,KAAN,KAAA,CAAA,GAAA,KAAA,CAAA,GAAA,MAAM,CAAE,OAAO,CAAC,GAAG,CAAC,CAAA;gBACpB,IAAI,CAAC,OAAO,EAAE,CAAA;AAChB,aAAC,EACD,IAAI,EAAE,CAAC,GAAQ,KAAI;gBACjB,MAAM,KAAA,IAAA,IAAN,MAAM,KAAN,KAAA,CAAA,GAAA,KAAA,CAAA,GAAA,MAAM,CAAE,IAAI,CAAC,GAAG,CAAC,CAAA;gBACjB,IAAI,CAAC,OAAO,EAAE,CAAA;AAChB,aAAC,GACF,CAAA;AACD,QAAA,IAAI,CAAC,QAAQ,GAAG,oBAAoB,CAAC,WAAW,EAAE,CAAC,cAAc,CAAC,IAAI,CAAC,SAAS,EAAE,OAAO,CAAC,CAAA;KAC3F;IAED,OAAO,iBAAiB,CAAE,MAAW,EAAA;AACnC,QAAA,OAAO,IAAI,aAAa,CAAC,MAAM,CAAC,CAAA;KACjC;IAED,KAAK,GAAA;AACH,QAAA,oBAAoB,CAAC,WAAW,EAAE,CAAC,mBAAmB,CAAC,EAAE,EAAE,IAAI,CAAC,SAAS,EAAE,OAAO,EAAE,IAAI,CAAC,QAAQ,CAAC,CAAA;QAClG,IAAI,CAAC,OAAO,EAAE,CAAA;KACf;AAED,IAAA,iBAAiB,CAAE,MAAW,EAAA;AAC5B,QAAA,oBAAoB,CAAC,WAAW,EAAE,CAAC,wBAAwB,CAAC,MAAM,EAAE,IAAI,CAAC,SAAS,EAAE,mBAAmB,EAAE,IAAI,CAAC,QAAQ,CAAC,CAAA;KACxH;AAED,IAAA,kBAAkB,CAAE,MAAW,EAAA;AAC7B,QAAA,oBAAoB,CAAC,WAAW,EAAE,CAAC,mBAAmB,CAAC,MAAM,EAAE,IAAI,CAAC,SAAS,EAAE,oBAAoB,EAAE,IAAI,CAAC,QAAQ,CAAC,CAAA;KACpH;AAED,IAAA,KAAK,CACH,UAAiF,EAAA;AAEjF,QAAA,OAAO,OAAO,CAAC,OAAO,CAAC,UAAU,CAAC,CAAA;KACnC;AAED,IAAA,gBAAgB,CAAE,MAAW,EAAA;AAC3B,QAAA,OAAO,MAAM,CAAA;KACd;AAED,IAAA,eAAe,CAAE,MAAW,EAAA;AAC1B,QAAA,OAAO,MAAM,CAAA;KACd;IAED,OAAO,GAAA;AACL,QAAA,oBAAoB,CAAC,WAAW,EAAE,CAAC,eAAe,CAAC,IAAI,CAAC,SAAS,EAAE,IAAI,CAAC,QAAQ,CAAC,CAAA;KAClF;AAED,IAAA,IAAI,CACF,UAAiF,EAAA;AAEjF,QAAA,OAAO,OAAO,CAAC,OAAO,CAAC,UAAU,CAAC,CAAA;KACnC;AAED,IAAA,OAAO,CAAE,SAA2C,EAAA;AAClD,QAAA,MAAM,IAAI,KAAK,CAAC,SAAsB,CAAC,CAAA;KACxC;AACF,CAAA;AAjEW,EAAA,GAAA,MAAM,CAAC,WAAW;;;;"}